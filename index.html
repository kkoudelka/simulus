<!--
  ~ Copyright (c) 2019. Jan Koupil, Karel Koudelka, all rights reserved
  -->

<!DOCTYPE HTML>
<html>

<head>
    <meta charset=utf-8/>
    <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="./MDBootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="./MDBootstrap/css/mdb.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/simulus.css">
    <link rel="stylesheet" href="assets/codemirror.css">
    <!--<script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>-->
    <script type="text/javascript" src="./MDBootstrap/js/jquery-3.3.1.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="./MDBootstrap/js/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="./MDBootstrap/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="./MDBootstrap/js/mdb.min.js"></script>
    <script type="text/javascript" src="./MDBootstrap/js/addons/jquery-ui.min.js"></script>
    <script type="text/javascript" src="./MDBootstrap/js/addons/jquery-ui-touch-punch.min.js"></script>

    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script src="assets/simulus.js"></script>
    <script src="assets/Vector.js"></script>
    <script src="assets/logic.js"></script>
    <script src="assets/navigation.js"></script>
    <script src="assets/codemirror.js"></script>
    <script src="assets/modes/javascript/javascript.js"></script>
    <script src="layout.js"></script>
    <script src="model.js"></script>


</head>

<body>
<!-- Modal -->
<div class="modal fade right" id="navigation-modal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalPreviewLabel" aria-hidden="true" data-backdrop='true'>
    <div class="modal-dialog modal-md modal-info modal-dialog-centered modal-notify" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-white" id="exampleModalPreviewLabel">Navigation</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" class="text-white">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul>
                    <li>Mouse wheel - zoom X axis</li>
                    <li>Shift + Mouse wheel - zoom Y axis</li>
                    <li>Ctrl + Mouse - move</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->

<!-- Modal -->
<div class="modal fade right" id="settings-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalPreviewLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-full-height modal-lg  modal-right" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Settings</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!--Accordion wrapper-->
                <div class="accordion md-accordion" id="accordionEx" role="tablist" aria-multiselectable="true">

                    <!-- Accordion card -->
                    <div class="card">

                        <!-- Card header -->
                        <div class="card-header" role="tab" id="headingOne1">
                            <a data-toggle="collapse" data-parent="#accordionEx" href="#collapseOne1"
                               aria-expanded="true"
                               aria-controls="collapseOne1">
                                <h5 class="mb-0">
                                    Variables <i class="fas fa-angle-down rotate-icon"></i>
                                </h5>
                            </a>
                        </div>

                        <!-- Card body -->
                        <div id="collapseOne1" class="collapse show" role="tabpanel" aria-labelledby="headingOne1"
                             data-parent="#accordionEx">
                            <div class="card-body">
                                <textarea id="variables-textarea"></textarea>
                            </div>
                            <div class="card-footer">
                                    <button class="btn btn-outline-primary" id="vars-save">Save</button>
                            </div>
                        </div>

                    </div>
                    <!-- Accordion card -->

                    <!-- Accordion card -->
                    <div class="card">

                        <!-- Card header -->
                        <div class="card-header" role="tab" id="headingTwo2">
                            <a class="collapsed" data-toggle="collapse" data-parent="#accordionEx" href="#collapseTwo2"
                               aria-expanded="false" aria-controls="collapseTwo2">
                                <h5 class="mb-0">
                                    Script <i class="fas fa-angle-down rotate-icon"></i>
                                </h5>
                            </a>
                        </div>

                        <!-- Card body -->
                        <div id="collapseTwo2" class="collapse" role="tabpanel" aria-labelledby="headingTwo2"
                             data-parent="#accordionEx">
                            <div class="card-body">
                                <textarea id="code-textarea"></textarea>

                            </div>
                            <div class="card-footer">
                                <button class="btn btn-outline-primary" id="code-save">Save</button>
                            </div>
                        </div>

                    </div>
                    <!-- Accordion card -->

                </div>
                <!-- Accordion wrapper -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->


<div id="chartContainer" style="width: 100vw; height: 90vh; "></div>

<div id="draggable" class="card w-25 animated-transitions"
     style="z-index: 50; position: absolute; right: 20px; top: 20px;">
    <h5 class="card-header primary-color white-text">Variables</h5>
    <div class="card-body">
        <div class="container">
            <div class="row">
                <table id="variables" class="table" style="line-height: 1px;"></table>

            </div>
        </div>
    </div>
</div>

<div class="d-flex" style="position: absolute; bottom: 0; width: 90vw;">
    <button class="btn btn-outline-primary waves-effect" id="toggleSimulation">Start simulation</button>
    <button class="btn btn-outline-primary waves-effect" id="stepSimulation"><i class="fas fa-step-forward"></i>&nbsp;Step
    </button>
    <button class="btn btn-outline-primary waves-effect" id="smallStepSimulation">Small Step</button>
    <button class="btn btn-outline-primary waves-effect" id="minStepSimulation">Minimum step</button>
    <button class="btn btn-outline-primary waves-effect" id="reload"><i class="fas fa-redo-alt"></i>&nbsp;Reload
    </button>
    <button class="btn btn-outline-primary waves-effect" id="settings"><i class="fas fa-cog"></i>&nbsp;Settings</button>
</div>

<script type="text/javascript">
    $(document).ready(function () {

        let chart = new CanvasJS.Chart("chartContainer", layout.chartProps);
        let simulus = new Simulus(new Model(), chart);
        window.simulus = simulus;
        simulus.render();
        simulus.displayVars();


        animationFrameId = null;

        function loop() {
            animationFrameId = window.requestAnimationFrame(loop);
            for (let i = 0; i < simulus.model.displayedPointRatio; i++) {
                if (!simulus.model.step()) { //stop simulation
                    window.cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
            }
            simulus.render();
            simulus.displayVars();
        }

        function step(divider) {
            window.cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
            for (let i = 0, l = simulus.model.displayedPointRatio / divider; i < l; i++) {
                simulus.model.step()  //stop simulation
            }
            simulus.render();
            simulus.displayVars();
        }

        $("#toggleSimulation").on('click', function () {
            if (animationFrameId === null) {
                animationFrameId = window.requestAnimationFrame(loop);

                $(this).addClass('btn-outline-success').removeClass('btn-outline-danger');
                $(this).html('<i class="fas fa-play"></i>&nbsp;Simulating');
            } else {
                window.cancelAnimationFrame(animationFrameId);
                $(this).addClass('btn-outline-danger').removeClass('btn-outline-success');
                $(this).html('<i class="fas fa-pause"></i>&nbsp;Paused');

                animationFrameId = null;
            }
        });

        $("#stepSimulation").on('click', function () {
            step(1);
        });

        $("#smallStepSimulation").on('click', function () {
            step(10);
        });

        $("#minStepSimulation").on('click', function () {
            step(simulus.model.displayedPointRatio);
        });

        $("#settings").on('click', function () {
            $('#settings-modal').modal('show');
        });

        $("#reload").on('click', function () {
            location.reload();
        });


    });
</script>

</body>

</html>
